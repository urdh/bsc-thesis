\documentclass[../rapport_MVEX01-11-05]{subfiles}
\begin{document}

\subsection{Klassificering av hudfärg}

För att skilja pixlar med hud från bakgrundspixlar, vilket är ett
centralt problem inom gestigenkänning, används en modell där pixelfärgen antas
bero stokastiskt på om det är en hud- eller
bakgrundspixel. Pixelfärgen antas vara en multivariat normalfördelad
slumpvariabel, där fördelningen beror på om pixeln innehåller hud
eller inte. För att täcka olika hudfärger kan en uppsättning olika
fördelningar för hudfärger användas (\cite{Elmezain08}), där en total
sannolikhetsfördelning sedan är en linjärkombination av dessa. Det
samma kan göras med sannolikhetsfördelningen för pixlar som inte
innehåller hud. I vårt arbete har vi dock avänt en enda fördelning för
hud, och ''ohudsfördelningen'' har antagits vara konstant. Detta då en
uppskattad normalfördelning konsekvent fick alldeles för liten
varians. Detta resultat strämmer överens med Elmezain et al, som även
de hade mindre varians bland pixlar som inte innehöll hud än de som
innehöll hud.

För att bestämma väntevärdesvektorn och kovariansmatrisen i en
uppskattad normalfördelning krävs ett
antal datapunkter, med vilka vi kan uppskatta parametrarna med MLE.

Den mulitvariata fördelningen ges av

\begin{equation*}
  p(x)=\frac{1}{(2\pi)^{d/2}|\Sigma|^{1/2}}e^{-(x-\mu)^T\Sigma^{-1}(x-\mu)/2}
\end{equation*}

med kovariansmatris $\Sigma$ och väntevärde $\mu$.
Givet $N$ datapunkter $x_i,\:1\leq i\leq N$ ges den logaritmerade
sannolikheten $l(\mu,\Sigma|x_1,{\ldots} ,x_N)$ av

\begin{equation*}
  \begin{aligned}
  l(\mu,\Sigma|x_1,...,x_N) = &-\frac{Nd}{2}\log(2\pi)-\frac{N}{2}\log|\Sigma|\\
                              &-\sum_{i=1}^N\frac{(x_i-\mu)^T\Sigma^{-1}(x_i-\mu)}{2}.
  \end{aligned}
\end{equation*}

Vi kan därefter beräkna derivatan med avseende på $\mu$,

\begin{equation*}
  \frac{\partial l}{\partial \mu}=\sum_{i=1}^N(x_i-\mu)^T\Sigma^{-1},
\end{equation*}

samt derivatan med avseende på $\Sigma^{-1}$,

\begin{equation*}
  \frac{\partial l}{\partial \Sigma^{-1}}=\frac{N}{2}\Sigma
  -\sum_{i=1}^N\frac{(x_i-\mu)(x_i-\mu)^T}{2}.
\end{equation*}

Sätter vi dem i tur och ordning till noll får vi uppskattningarna $\hat\mu$ och $\hat\Sigma$:

\marginpar{Hur då? Det är \emph{inte} uppenbart!}

\begin{gather*}
  \hat\mu    =\frac{1}{N}-\sum_{i=1}^Nx_i\\
  \hat\Sigma =\frac{1}{N-1}\sum_{i=1}^N(x_i-\hat\mu)(x_i-\hat\mu)^T
\end{gather*}

\citeasnoun{Elmezain08} studerade $18\:972$
hud-pixlar och $88\:320$ icke-hud-pixlar, och delade in dessa i fyra
hudfördelningar och en icke-hud-fördelning. De fyra hudfördelningarna
optimerades genom att varje pixel sorterades till en
ursprungsfördelning, varefter parametrarna uppdaterades, och alla
pixlar sorterades om efter de uppkomna fördelningarna --- detta gjordes
iterativt till konvergens.

%Sådana beräkningar gjordes av \citeasnoun{Elmezain08} på 18972
%hud-pixlar och 88320 icke-hud-pixlar. Deras resultat har vi sedan
%använt i vårt arbete.

\subsubsection{SPM --- Skin Probability Map}

För varje pixelfärg kan sannolikheten för att pixeln föreställer hud
respektive ohud bestämmas med fördelningarna ovan, med en korrektion
för att det i allmänhet är troligare att pixlar är ohud än hud. Detta
innebär att om kvoten
\begin{equation*}
\frac{P(hud|färg)}{P(ohud|färg)}=\frac{P(färg|hud)P(hud)}{P(färg)}\frac{P(färg}{P(ohud)P(ohud|färg)}=\frac{P(färg|hud)P(hud)}{P(färg|ohud)P(ohud)}
\end{equation*}
är större än ett, så sägs pixeln föreställa hud. Kvoten
$P(hud)/P(ohud)$ sätts för att ange hur mycket vanligare ohud-pixlar
är i bilderna. Då vår sannolikhetsfördelning för ohud är en så grov
uppskattning, har denna kvot fått korrigeras för hand för att optimera
resultatet.

Problemet med denna uträkning är att sannolikheten är tidskrävande att
räkna ut, och därför olämplig att göra för varje pixel i varje bild i
filmen. Detta löses genom att göra beräkningen en gång för alla för
varje tänkbar färg ($256^2$ stycken). Resultatet sparas sedan i en
matris 256x256-matris, där färgen blir en koordinat. Denna matris
kallas för en Skin Probability Map, och genom att slå i den kan man
direkt se om en pixel ska klassas som hud eller ej.

\end{document} 
